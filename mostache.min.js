(function(B,g){"object"==typeof exports&&exports&&"string"!=typeof exports.nodeName?g(exports):"function"==typeof define&&define.amd?define(["exports"],g):(B.Mustache={},g(Mustache)),g.global=B})(this,function mustacheFactory(g){function w(a){return"function"==typeof a}function C(a,c){return a!=G&&"object"==typeof a&&c in a}function H(a,c){function b(a){"string"==typeof a&&(a=a.split(I,2));if(!x(a)||2!==a.length)throw Error("Invalid tags: "+a);u=new RegExp(a[0].replace(y,"\\$&")+"\\s*"),q=new RegExp("\\s*"+a[1].replace(y,"\\$&")),D=new RegExp("\\s*"+("}"+a[1]).replace(y,"\\$&"))}if(!a)return[];var f=[],d=[],m=[],k=!1,e=!1,u,q,D;b(c||g.tags);for(var n=new v(a),p,l,t,h;n.tail;){p=n.pos;if(t=n.scanUntil(u)){h=0;for(var r=t.length;h<r;++h)if(l=t.charAt(h),J.test(l)?m.push(d.length):e=!0,d.push(["text",l,p,p+1]),p+=1,"\n"===l){if(k&&!e)for(;m.length;)delete d[m.pop()];else m=[];e=k=!1}}if(!n.scan(u))break;k=!0,l=n.scan(K)||"name",n.scan(L),"="===l?(t=n.scanUntil(E),n.scan(E),n.scanUntil(q)):"{"===l?(t=n.scanUntil(D),n.scan(M),n.scanUntil(q),l="&"):t=n.scanUntil(q);if(!n.scan(q))throw Error("Unclosed tag at "+n.pos);h=[l,t,p,n.pos],d.push(h);if("#"===l||"^"===l)f.push(h);else if("/"===l){l=f.pop();if(!l)throw Error('Unopened section "'+t+'" at '+p);if(l[1]!==t)throw Error('Unclosed section "'+l[1]+'" at '+p)}else"name"===l||"{"===l||"&"===l?e=!0:"="===l&&b(t)}if(l=f.pop())throw Error('Unclosed section "'+l[1]+'" at '+n.pos);return N(O(d))}function O(a){for(var c=[],b,f,d=0,m=a.length;d<m;++d)if(b=a[d])f&&"text"===b[0]&&"text"===f[0]?(f[1]+=b[1],f[3]=b[3]):(c.push(b),f=b);return c}function N(a){for(var c=[],b=c,f=[],d,m=0,k=a.length;m<k;++m)switch(d=a[m],d[0]){case"#":case"^":b.push(d),f.push(d),b=d[4]=[];break;case"/":b=f.pop(),b[5]=d[2],b=0<f.length?f[f.length-1][4]:c;break;default:b.push(d)}return c}function v(a){this.tail=this.string=a,this.pos=0}function r(a,c){this.view=a,this.cache={".":this.view},this.parent=c}function h(){this.cache={}}var P=Object.prototype.toString,x=Array.isArray||function(a){return"[object Array]"===P.call(a)},G,Q=/\{\{!([\w\.]+?)\}\}/g,R=/(\W)@([#\^!\/\|\)\(]?[\w\.$]+)/g,S=/\s*\=\s*/,T=/\s*\:\s*/,U=/\s*\,\s*/,V=/\s*\|\s*/,F=/\{INDEX\}/g,W=/[&<>"'\/]/g,y=/[\-\[\]{}()*+?.,\\\^$|#\s]/g,z=/\{SEP\}([\w\W]+?)\{\/SEP\}/g,J=/\S/,X={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},L=/\s*/,I=/\s+/,E=/\s*=/,M=/\s*\}/,K=/#|\^|\/|>|\{|&|=|!/;v.prototype.eos=function(){return""===this.tail},v.prototype.scan=function(a){var c=this.tail;return a=c.match(a),!a||0!==a.index?"":(a=a[0],this.tail=c.substring(a.length),this.pos+=a.length,a)},v.prototype.scanUntil=function(a){a=this.tail.search(a);var c;switch(a){case-1:c=this.tail,this.tail="";break;case 0:c="";break;default:c=this.tail.substring(0,a),this.tail=this.tail.substring(a)}return this.pos+=c.length,c},r.prototype.push=function(a){return new r(a,this)},r.prototype.lookup=function(a){var c=this.cache,b,f,d,m=[];-1!==a.indexOf("=")&&(d=a.trim().split(S),a=d[0],c[a]!=d[1]&&c["."][a]!=d[1]&&(a=""),d=void 0),-1!==a.indexOf(":")&&(d=a.trim().split(T),a=d[0],c.__NAME=d[1],d=void 0),-1!==a.indexOf("|")&&(d=a.trim().split(V).map(function(a,b){return"."===a.slice(0,1)&&(m[b-1]=!0,a=a.slice(1)),a}),a=d.shift());if(void 0==(b=c[a])){for(var k=this,e,u,h=!1;k;){if(0<a.indexOf("."))for(b=k.view,e=a.split("."),u=0,"__"!==e[0]||k.parent||e.shift(),f=e.length;void 0!=b&&u<f;)u===f-1&&(h=C(b,e[u])),b=b[e[u++]];else b=k.view[a],h=C(k.view,a);if(h)break;k=k.parent}c[a]=b}return void 0!==d&&d.forEach(function(c,f){var d=c.split("(");c=d.shift(),d.length&&(d=d[0].trim().split(")")[0].trim().split(U).map(function(a){try{return JSON.parse(a)}catch(b){return a}}));var e=function(a,b){return b.split(/[\.,]/).reduce(function(a,b){return a&&a[b]},a)}(m[f]?void 0===b?a:b:mustacheFactory.global,c);if("function"==typeof e){void 0===b&&(b=a);try{if(m[f])b=d.length?e.apply(b,d):e.call(b);else if(d.length)switch(d.length){case 1:return b=e(b,d[0]);case 2:return b=e(b,d[0],d[1]);case 3:return b=e(b,d[0],d[1],d[2]);default:return e.apply(this,[b].concat(d))}else b=e(b)}catch(k){}}}),w(b)&&(b=(String(b).indexOf("[native code]"),b.call(this.view))),b},h.prototype.clearCache=function(){this.cache={}},h.prototype.parse=function(a,c){var b=this.cache,f=b[a];return void 0==f&&(f=b[a]=H(a,c)),f},h.prototype.render=function(a,c,b){var f=this.parse(a);return c=c instanceof r?c:new r(c),this.renderTokens(f,c,b,a)},h.prototype.renderTokens=function(a,c,b,f){for(var d="",m,k,e,h=0,g=a.length;h<g;++h){e=void 0,m=a[h],k=m[0];switch(k){case"#":e=this.renderSection(m,c,b,f);break;case"^":e=this.renderInverted(m,c,b,f);break;case">":e=this.renderPartial(m,c,b,f);break;case"&":e=this.unescapedValue(m,c);break;case"name":e=this.escapedValue(m,c);break;case"text":e=this.rawValue(m)}void 0!==e&&(d+=e)}return d},h.prototype.renderSection=function(a,c,b,f){function d(a){return h.render(a,c,b)}var h=this,k="",e=c.lookup(a[1]),g="$1";if(e){if(x(e))for(var q=0,r=e.length;q<r;++q)g=r-1===q?"":"$1",k+=this.renderTokens(a[4],c.push(e[q]),b,f).replace(F,q+1).replace(z,g);else if("object"==typeof e||"string"==typeof e||"number"==typeof e)if(void 0!=e&&"object"==typeof e&&c.cache.__NAME)for(var n in e){var p=e[n],g=p;if("object"==typeof p){p={},p[c.cache.__NAME]=n;for(var l in g)g.hasOwnProperty(l)&&(p[l]=g[l])}else p=new p.constructor(p),p[c.cache.__NAME]=n;g=r-1===q?"":"$1",k+=this.renderTokens(a[4],c.push(p),b,f).replace(F,n).replace(z,g)}else k+=this.renderTokens(a[4],c.push(e),b,f).replace(z,g);else if(w(e)){if("string"!=typeof f)throw Error("Cannot use higher-order sections without the original template");e=e.call(c.view,f.slice(a[3],a[5]),d),void 0!=e&&(k+=e)}else k+=this.renderTokens(a[4],c,b,f);return k}},h.prototype.renderInverted=function(a,c,b,f){var d=c.lookup(a[1]);if(!d||x(d)&&0===d.length)return this.renderTokens(a[4],c,b,f)},h.prototype.renderPartial=function(a,c,b){if(b&&(a=w(b)?b(a[1]):b[a[1]],void 0!=a))return this.renderTokens(this.parse(a),c,b,a)},h.prototype.unescapedValue=function(a,c){var b=c.lookup(a[1]);if(void 0!=b)return b},h.prototype.escapedValue=function(a,c){var b=c.lookup(a[1]);if(void 0!=b)return g.escape(b)},h.prototype.rawValue=function(a){return a[1]},g.name="mustache.js",g.version="2.1.3",g.tags=["{{","}}"];var A=new h;g.clearCache=function(){return A.clearCache()},g.parse=function(a,c){return A.parse(a,c)},g.render=function(a,c,b){if("string"!=typeof a)throw c=TypeError,a=x(a)?"array":typeof a,new c('Invalid template! Template should be a "string" but "'+a+'" was given as the first argument for mustache#render(template, view, partials)');return-1!==a.indexOf("{{@@}}")&&(a=a.replace(R,"$1{{$2}}")),A.render(a.replace(Q,"{{/$1}}{{^$1}}"),c,b)},g.to_html=function(a,c,b,f){a=g.render(a,c,b);if(!w(f))return a;f(a)},g.escape=function(a){return String(a).replace(W,function(a){return X[a]})},g.Scanner=v,g.Context=r,g.Writer=h});
