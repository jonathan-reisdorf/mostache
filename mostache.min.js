;(function(B,m){"object"==typeof exports&&exports&&"string"!=typeof exports.nodeName?m(exports):"function"==typeof define&&define.amd?define(["exports"],m):(B.Mustache={},m(Mustache)),m.global=B})(this,function mustacheFactory(m){function x(a){return"function"==typeof a}function z(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function C(a,c){return null!=a&&"object"==typeof a&&c in a}function E(a,c){function b(a){"string"==typeof a&&(a=a.split(F,2));if(!y(a)||2!==a.length)throw Error("Invalid tags: "+a);r=new RegExp(z(a[0])+"\\s*"),v=new RegExp("\\s*"+z(a[1])),t=new RegExp("\\s*"+z("}"+a[1]))}if(!a)return[];var d=[],l=[],k=[],f=!1,e=!1,r,v,t;b(c||m.tags);for(var n=new w(a),q,h,p,g;!n.eos();){q=n.pos;if(p=n.scanUntil(r)){g=0;for(var u=p.length;g<u;++g)if(h=p.charAt(g),G.call(H,h)?e=!0:k.push(l.length),l.push(["text",h,q,q+1]),q+=1,"\n"===h){if(f&&!e)for(;k.length;)delete l[k.pop()];else k=[];e=f=!1}}if(!n.scan(r))break;f=!0,h=n.scan(I)||"name",n.scan(J),"="===h?(p=n.scanUntil(D),n.scan(D),n.scanUntil(v)):"{"===h?(p=n.scanUntil(t),n.scan(K),n.scanUntil(v),h="&"):p=n.scanUntil(v);if(!n.scan(v))throw Error("Unclosed tag at "+n.pos);g=[h,p,q,n.pos],l.push(g);if("#"===h||"^"===h)d.push(g);else if("/"===h){h=d.pop();if(!h)throw Error('Unopened section "'+p+'" at '+q);if(h[1]!==p)throw Error('Unclosed section "'+h[1]+'" at '+q)}else"name"===h||"{"===h||"&"===h?e=!0:"="===h&&b(p)}if(h=d.pop())throw Error('Unclosed section "'+h[1]+'" at '+n.pos);return L(M(l))}function M(a){for(var c=[],b,d,l=0,k=a.length;l<k;++l)if(b=a[l])"text"===b[0]&&d&&"text"===d[0]?(d[1]+=b[1],d[3]=b[3]):(c.push(b),d=b);return c}function L(a){for(var c=[],b=c,d=[],l,k=0,f=a.length;k<f;++k)switch(l=a[k],l[0]){case"#":case"^":b.push(l),d.push(l),b=l[4]=[];break;case"/":b=d.pop(),b[5]=l[2],b=0<d.length?d[d.length-1][4]:c;break;default:b.push(l)}return c}function w(a){this.tail=this.string=a,this.pos=0}function u(a,c){this.view=a,this.cache={".":this.view},this.parent=c}function g(){this.cache={}}var N=Object.prototype.toString,y=Array.isArray||function(a){return"[object Array]"===N.call(a)},G=RegExp.prototype.test,H=/\S/,O={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},J=/\s*/,F=/\s+/,D=/\s*=/,K=/\s*\}/,I=/#|\^|\/|>|\{|&|=|!/;w.prototype.eos=function(){return""===this.tail},w.prototype.scan=function(a){return a=this.tail.match(a),!a||0!==a.index?"":(a=a[0],this.tail=this.tail.substring(a.length),this.pos+=a.length,a)},w.prototype.scanUntil=function(a){a=this.tail.search(a);var c;switch(a){case-1:c=this.tail,this.tail="";break;case 0:c="";break;default:c=this.tail.substring(0,a),this.tail=this.tail.substring(a)}return this.pos+=c.length,c},u.prototype.push=function(a){return new u(a,this)},u.prototype.lookup=function(a){var c=this.cache,b,d,l=[];-1!==a.indexOf("=")&&(d=a.trim().split(/\s*\=\s*/),a=d[0],c[a]!=d[1]&&c["."][a]!=d[1]&&(a=""),d=null),-1!==a.indexOf(":")&&(d=a.trim().split(/\s*\:\s*/),a=d[0],c.__NAME=d[1],d=null),-1!==a.indexOf("|")&&(d=a.trim().split(/\s*\|\s*/).map(function(a,b){return"."===a.slice(0,1)&&(l[b-1]=!0,a=a.slice(1)),a}),a=d.shift());if(c.hasOwnProperty(a))b=c[a];else{for(var k=this,f,e,r=!1;k;){if(0<a.indexOf("."))for(b=k.view,f=a.split("."),e=0,k.parent||"__"!==f[0]||f.shift();null!=b&&e<f.length;)e===f.length-1&&(r=C(b,f[e])),b=b[f[e++]];else b=k.view[a],r=C(k.view,a);if(r)break;k=k.parent}c[a]=b}return d&&d.forEach(function(c,d){var e=c.split("(");c=e.shift(),e.length&&(e=e[0].trim().split(")")[0].trim().split(/\s*\,\s*/).map(function(a){try{return JSON.parse(a)}catch(b){return a}}));var f=function(a,b){return b.split(/[\.,]/).reduce(function(a,b){return a&&a[b]},a)}(l[d]?void 0===b?a:b:mustacheFactory.global,c);if("function"==typeof f){void 0===b&&(b=a);try{if(l[d])b=e.length?f.apply(b,e):f.call(b);else if(e.length)switch(e.length){case 1:return b=f(b,e[0]);case 2:return b=f(b,e[0],e[1]);case 3:return b=f(b,e[0],e[1],e[2]);default:return f.apply(this,[b].concat(e))}else b=f(b)}catch(h){}}}),x(b)&&(b=(String(b).indexOf("[native code]"),b.call(this.view))),b},g.prototype.clearCache=function(){this.cache={}},g.prototype.parse=function(a,c){var b=this.cache,d=b[a];return null==d&&(d=b[a]=E(a,c)),d},g.prototype.render=function(a,c,b){var d=this.parse(a);return c=c instanceof u?c:new u(c),this.renderTokens(d,c,b,a)},g.prototype.renderTokens=function(a,c,b,d){for(var l="",k,f,e,r=0,g=a.length;r<g;++r)e=void 0,k=a[r],f=k[0],"#"===f?e=this.renderSection(k,c,b,d):"^"===f?e=this.renderInverted(k,c,b,d):">"===f?e=this.renderPartial(k,c,b,d):"&"===f?e=this.unescapedValue(k,c):"name"===f?e=this.escapedValue(k,c):"text"===f&&(e=this.rawValue(k)),void 0!==e&&(l+=e);return l},g.prototype.renderSection=function(a,c,b,d){function l(a){return k.render(a,c,b)}var k=this,f="",e=c.lookup(a[1]),g="$1",m=/\{SEP\}([\w\W]+?)\{\/SEP\}/g;if(e){if(y(e))for(var t=0,n=e.length;t<n;++t)g=n-1===t?"":"$1",f+=this.renderTokens(a[4],c.push(e[t]),b,d).replace(/\{INDEX\}/g,t+1).replace(m,g);else if("object"==typeof e||"string"==typeof e||"number"==typeof e)if(null!=e&&"object"==typeof e&&c.cache.__NAME)for(var q in e){var h=e[q],g=h;if("object"==typeof h){h={},h[c.cache.__NAME]=q;for(var p in g)g.hasOwnProperty(p)&&(h[p]=g[p])}else h=new h.constructor(h),h[c.cache.__NAME]=q;g=n-1===t?"":"$1",f+=this.renderTokens(a[4],c.push(h),b,d).replace(/\{INDEX\}/g,q).replace(m,g)}else f+=this.renderTokens(a[4],c.push(e),b,d).replace(m,g);else if(x(e)){if("string"!=typeof d)throw Error("Cannot use higher-order sections without the original template");e=e.call(c.view,d.slice(a[3],a[5]),l),null!=e&&(f+=e)}else f+=this.renderTokens(a[4],c,b,d);return f}},g.prototype.renderInverted=function(a,c,b,d){var g=c.lookup(a[1]);if(!g||y(g)&&0===g.length)return this.renderTokens(a[4],c,b,d)},g.prototype.renderPartial=function(a,c,b){if(b&&(a=x(b)?b(a[1]):b[a[1]],null!=a))return this.renderTokens(this.parse(a),c,b,a)},g.prototype.unescapedValue=function(a,c){var b=c.lookup(a[1]);if(null!=b)return b},g.prototype.escapedValue=function(a,c){var b=c.lookup(a[1]);if(null!=b)return m.escape(b)},g.prototype.rawValue=function(a){return a[1]},m.name="mustache.js",m.version="2.1.3",m.tags=["{{","}}"];var A=new g;m.clearCache=function(){return A.clearCache()},m.parse=function(a,c){return A.parse(a,c)},m.render=function(a,c,b){if("string"!=typeof a)throw c=TypeError,a=y(a)?"array":typeof a,new c('Invalid template! Template should be a "string" but "'+a+'" was given as the first argument for mustache#render(template, view, partials)');return A.render(a.replace(/\{\{!([\w\.]+?)\}\}/g,"{{/$1}}{{^$1}}"),c,b)},m.to_html=function(a,c,b,d){a=m.render(a,c,b);if(!x(d))return a;d(a)},m.escape=function(a){return String(a).replace(/[&<>"'\/]/g,function(a){return O[a]})},m.Scanner=w,m.Context=u,m.Writer=g};
